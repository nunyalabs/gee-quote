const t=t=>document.getElementById(t),e=t("itemName"),o=t("amountCny"),n=t("qty"),a=t("cnyToUsd"),i=t("usdToGhs"),l=t("feePct"),s=t("profitPct"),r=t("outItem"),d=t("outCny"),c=t("outUsd"),u=t("outUsdFee"),h=t("outGhs"),m=t("outProfitAmount"),g=t("outGhsProfit"),p=t("summarySection"),f=t("finalCardSection"),y=t("imgUpload"),C=t("imgPreview"),v=t("imgPreviewWrap"),w=document.querySelector(".upload-label"),b=t("quoteCanvas"),x=b.getContext("2d");let P=null,q=null;function $(t,e=2){return Number(t||0).toLocaleString(void 0,{minimumFractionDigits:e,maximumFractionDigits:e})}function calculate(){const t=e.value||"Item",y=parseFloat(o.value)||0,C=parseInt(n.value)||1,v=y/C,w=parseFloat(a.value)||.1408,b=parseFloat(i.value)||13,x=y*w,P=x*(1+(parseFloat(l.value)||0)/100),q=P*b,R=q*(1+(parseFloat(s.value)||0)/100),S=Math.round(R),T=S-q;return r.textContent=t,d.textContent=`${$(y,2)} CNY (${$(v,2)} per unit)`,c.textContent=$(x,2),u.textContent=$(P,2),h.textContent=$(q,2),m.textContent=`GHâ‚µ ${$(T)}`,g.textContent=`GHâ‚µ ${$(S,0)}`,p.style.display="block",F({item:t,amount:y,quantity:C,usdBeforeFee:x,usdAfterFee:P,ghs:q,ghsWithProfit:S}),f.style.display="block",{item:t,amount:y,quantity:C,usdBeforeFee:x,usdAfterFee:P,ghs:q,ghsWithProfit:S}}function F(t){const e=b.width,o=b.height,n=x.createLinearGradient(0,0,0,o);if(n.addColorStop(0,"#B0E0E6"),n.addColorStop(.5,"#87CEEB"),n.addColorStop(1,"#ADD8E6"),x.fillStyle=n,x.fillRect(0,0,e,o),x.fillStyle="rgba(255, 255, 255, 0.1)",x.fillRect(0,0,e,o),x.fillStyle="rgba(255, 255, 255, 0.95)",x.beginPath(),x.roundRect(20,15,e-40,50,12),x.fill(),x.fillStyle="#1d1d1f",x.font="bold 18px -apple-system, system-ui",x.textAlign="center",x.fillText(t.item,e/2,45),P){const t=Math.min(.8*e,.55*o),n=Math.min(t/P.width,t/P.height),a=P.width*n,i=P.height*n,l=(e-a)/2,s=85;x.save(),x.beginPath(),x.roundRect(l,s,a,i,16),x.clip(),x.drawImage(P,l,s,a,i),x.restore(),x.shadowColor="rgba(0, 0, 0, 0.3)",x.shadowBlur=10,x.shadowOffsetY=5,x.strokeStyle="rgba(255, 255, 255, 0.3)",x.lineWidth=2,x.beginPath(),x.roundRect(l,s,a,i,16),x.stroke(),x.shadowColor="transparent",x.shadowBlur=0,x.shadowOffsetY=0}const a=o-80;x.fillStyle="rgba(255, 255, 255, 0.95)",x.beginPath(),x.roundRect(20,a-20,e-40,60,16),x.fill(),x.fillStyle="#1d1d1f",x.font="bold 28px -apple-system, system-ui",x.textAlign="center",x.fillText(`GHâ‚µ ${$(t.ghsWithProfit,0)}`,e/2,a+15),x.textAlign="left",q=b.toDataURL("image/png")}t("calcBtn").addEventListener("click",()=>{calculate()}),y.addEventListener("change",t=>{const e=t.target.files[0];if(!e)return;const o=new FileReader;o.onload=t=>{P=new Image,P.onload=()=>{C.src=P.src,v.style.display="block",w.style.display="none","none"!==p.style.display&&calculate()},P.src=t.target.result},o.readAsDataURL(e)}),t("updateQuoteBtn").addEventListener("click",()=>{document.getElementById("calcForm").scrollIntoView({behavior:"smooth",block:"start"}),e.focus()}),t("shareImageBtn").addEventListener("click",async()=>{if(!q){F(calculate())}const t=calculate();try{const o=await fetch(q),n=await o.blob(),a=(e.value||"quote").replace(/[^a-zA-Z0-9]/g,"_"),i=new File([n],`${a}_quote.png`,{type:"image/png"}),l=`ğŸ›ï¸ ${t.item}\nğŸ’° Price: GHâ‚µ ${$(t.ghsWithProfit,0)}\nğŸ“¦ Quantity: ${t.quantity}\n\nâœ¨ Professional quote from geeLogistics\nContact us for shipping & logistics services!`;if(navigator.share&&navigator.canShare({files:[i]}))await navigator.share({title:`Quote for ${e.value||"Item"}`,text:l,files:[i]});else{const t=`https://wa.me/?text=${encodeURIComponent(l)}`;window.open(t,"_blank"),setTimeout(()=>{const t=document.createElement("a");t.href=q,t.download=`${a}_quote_for_whatsapp.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t),alert("ğŸ’¬ WhatsApp opened in new tab\nğŸ“¸ Quote image downloaded\n\nPaste the image in your WhatsApp chat!")},500)}}catch(t){const o=calculate(),n=`ğŸ›ï¸ ${o.item}\nğŸ’° Price: GHâ‚µ ${$(o.ghsWithProfit,0)}\nğŸ“¦ Quantity: ${o.quantity}\n\nContact geeLogistics for more details!`,a=`https://wa.me/?text=${encodeURIComponent(n)}`;window.open(a,"_blank");const i=(e.value||"quote").replace(/[^a-zA-Z0-9]/g,"_"),l=document.createElement("a");l.href=q,l.download=`${i}_quote.png`,document.body.appendChild(l),l.click(),document.body.removeChild(l)}}),CanvasRenderingContext2D.prototype.roundRect||(CanvasRenderingContext2D.prototype.roundRect=function(t,e,o,n,a){this.moveTo(t+a,e),this.lineTo(t+o-a,e),this.quadraticCurveTo(t+o,e,t+o,e+a),this.lineTo(t+o,e+n-a),this.quadraticCurveTo(t+o,e+n,t+o-a,e+n),this.lineTo(t+a,e+n),this.quadraticCurveTo(t,e+n,t,e+n-a),this.lineTo(t,e+a),this.quadraticCurveTo(t,e,t+a,e),this.closePath()}),calculate();